# Поваренная Книга Vim

Оригинал: [dw-ap.blogspot.com](http://dw-ap.blogspot.com/2005/08/vim.html), [DW's journal](http://dw-ap.blogspot.com/) 
Перевод: [DW](mailto:dw at smtp.ru).

Это страница Поваренной Книги *Vim*. Она содержит короткие рецепты как сделать много простых и не простых вещей в *Vim*. Для начала ознакомления вы уже должны знать основы *Vim*, однако каждая команда детально объясняется.

Каждый набор инструкций является завершенным. Чувствуйте себя как дома и выбирайте именно то что вам нужно.

## Перестановка символов

Если вы быстро печатаете, ваши пальцы могут легко обогнать ваш разум. Часто люди путают местами символы. Например "the" превращается в "teh".

Для перестановки двух символов, к примеру "e" и "h", поместите курсор на "e" и наберите xp.

Команда "x" удаляет символ ("e") и "p" вставляет его после курсора (который теперь находится над "h".)

## Интерактивная замена одного слова другим (метод командной строки)

Предположим, вы хотите заменить в тексте каждое слово "идиот"словом "менеджер". Но вы хотите иметь возможность предпросмотра до замены.

Для этого нужно:

| #  |   Команды    |                                                      Разъяснение                                                      |
|----|--------------|-----------------------------------------------------------------------------------------------------------------------|
| 1. | *1G*         | Перейти в начало документа                                                                                            |
| 2. | */идиот*     | Найти первое вхождение слова "идиот"                                                                                  |
| 3. | *cwменеджер* | Заменить слово (cw) на менеджер                                                                                       |
| 4. | *n*          | Повторить последний поиск (найти следующего идиота.)                                                                  |
| 5. | *. (точка)*  | Повторить последнее редактирование, заменить слово на "менеджер"(Если вы не хотите менять слово, пропустите этот шаг) |

Повторяйте шаги 4 и 5 пока не замените все вхождения

### Какая Дева!?

Церковь только что купила свой первый компьютер и учиться его использовать. Церковный секретарь решила составить формальную прощальную проповедь для использования на похоронах. Имя покойного она решила заполнять в выражение "<имя>". При очередных похоронах она бы просто заменяла это выражение на имя покойного.

Как-то раз, когда проходили двое похорон, первое - некоей Марии, второе для некоей Эдны. Так что секретарь применила глобальную замену "<имя>" на "Мария". Отлично. Затем, во время вторых похорон, она заменила "Мария" на "Эдна". Это было ошибкой.

Представьте удивление священника, когда он начал чтение и произнес "Рождение Пресвятой Девы Эдны".

## Интерактивная замена одного слова другим (метод командной строки)

Предположим, вы хотите заменить в тексте каждое слово "идиот"словом "менеджер". Но вы хотите иметь возможность предпросмотра до замены.

Выполните команду :

```
:%s/\<идиот\>/менеджер/gc
```

Эта команда будет производить замену и останавливаться после каждого изменения, чтобы дать вам возможность подтвердить его. Ввод "y"означает принятие, а "n" - отказ от изменения.

Команда состоит из :

| #  |   Команды   |                                                      Разъяснение                                                       |
|----|-------------|------------------------------------------------------------------------------------------------------------------------|
| 1. | :           | Вход в командный режим                                                                                                 |
| 2. | %           | Выполнить эту команду на всех строках (% - синоним "от первой до последней строки".)                                   |
| 3. | s           | Сокращенная форма команды **:substitute**                                                                              |
| 4. | /\<идиот\>/ | Это выражение определяет текст, над которым предполагается поколдовать. \</b0> отмечает начало слова и \> - его конец. |
| 5. | /менеджер/  | Подставляемый текст                                                                                                    |
| 6. | gc          | Флаги                                                                                                                  |
|    |             | g - Глобально -- Заменяет каждое вхождение, не используя "с начала и до конце" на каждой строке                        |
|    |             | c - Подтверждение -- Спрашивать перед каждой заменой                                                                   |

## Замена одного слова другим одной командой

Предположим, вы хотите заменить в тексте каждое слово "идиот"словом "менеджер". И нет необходимости в подтверждении, так как все идиоты - менеджеры.

Используйте команду :

```
:%s/\<идиот\>/менеджер/g
```

Команда состоит из :

| #  |   Команды   |                                                      Разъяснение                                                       |
|----|-------------|------------------------------------------------------------------------------------------------------------------------|
| 1. | :           | Вход в командный режим                                                                                                 |
| 2. | %           | Выполнить эту команду на всех строках (% - синоним "от первой до последней строки".)                                   |
| 3. | s           | Сокращенная форма команды :substitute.                                                                                 |
| 4. | /\<идиот\>/ | Это выражение определяет текст, над которым предполагается поколдовать. \</b0> отмечает начало слова и \> - его конец. |
| 5. | /менеджер/  | Подставляемый текст                                                                                                    |
| 6. | g           | Глобальный флаг -- Этот флаг говорит Vim заменить каждое вхождение на лини, то есть не только первое.                  |

## Перемещение текста (в стиле Vi)

Предположим вы хотите переместить параграфы с верхней части теста в нижнюю. Есть несколько способов сделать это. В этом примере мы используем стиль Vi. В следующей части Перемещение текста (Визуальный режим) мы делаем это, используя команды Vim.

Выполните следующие действия :

| #  | Команды |                                                     Разъяснение                                                      |
|----|---------|----------------------------------------------------------------------------------------------------------------------|
| 1. |         | Переместите курсор на верх участка, который вы хотите переместить.                                                   |
| 2. | ma      | Поместите здесь метку "a". (Vim не выдает сообщения о выполнении этой команды. Другими словами, экран не изменится.) |
| 3. |         | Переместите курсор внизу участка, который вы хотите переместить.                                                     |
| 4. | d'a     | Удалите метку "a". Это поместит удаленный текст в буфер.                                                             |
| 5. |         | Переместите курсор на строку, где следует находиться тексту. Текст будет на следующей строке.                        |
| 6. | p       | Вставить текст подкурсором                                                                                           |

## Перемещение текста (Визуальный способ).

Предположим вы хотите переместить параграфы с верхней части теста в нижнюю. Есть несколько способов сделать это. В этом примере мы используем стиль Vim. В предыдущей части Перемещение текста (старый способ) мы делали это, используя команды Vi.

Выполните следующие действия :

| #  | Команды |                                                                   Разъяснение                                                                   |
|----|---------|-------------------------------------------------------------------------------------------------------------------------------------------------|
| 1. |         | Переместите курсор на верх участка, который вы хотите переместить.                                                                              |
| 2. | v       | Войдите в визуальный режим. (Если вы хотите переместить только полные линии, используйте команду V, которая включает визуальный строчный режим. |
| 3. |         | Переместите курсор внизу участка, который вы хотите переместить. Текст, предназначенный для перемещения, будет выделен.                         |
| 4. | d       | Выполняет визуальное удаление. Другими словами, удалить выделенный текст.                                                                       |
| 5. |         | Переместите курсор на строку, где следует находиться тексту. Текст будет на следующей строке.                                                   |
| 6. | p       | Вставить текст под курсором.                                                                                                                    |

## Копирование участка текста из одного файла в другой (В стиле Vi Style)

Есть несоклько способов копировать текст из одного файла в другой. В этом разделе более традиционные команды Vi. В следующем разделе Копирование с использованием визуального режима, мы выполним те же операции использую Визуальный режим.

Чтобы скопировать участок текста из одного файла в другой, введите следующие команды:

| #  |      Команды       |                                                Разъяснение                                                |
|----|--------------------|-----------------------------------------------------------------------------------------------------------|
| 1. |                    | Откройте для редактирования файл, содержащий текст, который вы хотите скопировать.                        |
| 2. |                    | Перейдите к верхней строке копируемого участка.                                                           |
| 3. | ma                 | Поставить на строку метку "a".                                                                            |
| 4. |                    | Перейдите к нижней строке копируемого участка.                                                            |
| 5. | y'a                | Скопировать (y) текст с текущей позиции до отметки "a" ('a)                                               |
| 6. | :split второй-файл | Открыть другое окно, содержащее второй файл. (Файл, в который должен быть скопирован текст.)              |
| 7. |                    | Переместите курсор на строку куда должен быть скопирован текст. Текст будет размещен на следующей строке. |
| 8. | p                  | Вставить текст после курсора.                                                                             |

## Копирование участка текста из одного файла в другой (Визуальный Метод)

Есть несоклько способов копировать текст из одного файла в другой. В этом разделе мы используем более новый, визуальный режим. В предыдущем разделе описан старый Vi-Стиль.

Чтобы скопировать участок текста из одного файла в другой, введите следующие команды:

| #  |      Команды       |                                                             Разъяснение                                                             |
|----|--------------------|-------------------------------------------------------------------------------------------------------------------------------------|
| 1. |                    | Откройте для редактирования файл, содержащий текст для копирования.                                                                 |
| 2. |                    | Перейдите к верхней строке копируемого участка.                                                                                     |
| 3. | v                  | Войти в визуальный режим. Если вы хотите копировать текст целыми строками, используйте V для включения Визуального Строчного Режима |
| 4. |                    | Перейдите на верхнюю стоку копируемого текста. Текст будет подсвечен.                                                               |
| 5. | y                  | Копировать (y) текст.                                                                                                               |
| 6. | :split второй-файл | Открыть другое окно, содержащее второй файл. (Файл, в который должен быть скопирован текст.)                                        |
| 7. |                    | Переместите курсор на строку куда должен быть скопирован текст. Текст будет размещен на следующей строке.                           |
| 8. | p                  | Вставить текст после курсора.                                                                                                       |

## Сортировка участка текста (Перемещение текста (в стиле Vi)

Часто вы будете редактировать файл, содержащий список имен. К примеру, список объектных файлов для компоновки в программу.

Пример:

```
version.o
pch.o
getopt.o
util.o
getopt1.o
inp.o
patch.o
backupfile.o
```

Этот список мило бы выглядел в алфавитном порядке. Или по меньшей мере в последовательности ASCII. Для сортировки по алфавиту введите следующие команды:

| #  | Команды |                                                                                    Разъяснение                                                                                     |
|----|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1. |         | Переместите курсор на первую сортируемую строку.                                                                                                                                   |
| 2. | ma      | Отметить первую строку как a.                                                                                                                                                      |
| 3. |         | Перейти вниз сортируемого текста.                                                                                                                                                  |
| 4. | !'asort | Команда ! указывает Vim пропустить текст через UNIX команду. 'a указывает редактору что обработать нужно участок с текущей строки и до метки a. Сортировку выполняет команда sort. |

Результат:

```
backupfile.o
getopt.o
getopt1.o
inp.o
patch.o
pch.o
util.o
version.o
```

### Предупреждение

На практике в большинстве Мэйкфайлов (файл, используемый UNIX для контроля компиляции) больше похож на:

```
OBJS = \
        version.o       \
        pch.o           \
        getopt.o        \
        util.o          \
        getopt1.o       \
        inp.o           \
        patch.o         \
        backupfile.o
```

Заметьте, что обратный слеш (\) использован для индикации конца строки. После сортировки получается:

```
OBJS = \
        backupfile.o
        getopt.o        \
        getopt1.o       \
        inp.o           \
        patch.o         \
        pch.o           \
        util.o          \
        version.o       \
```

Имена файлов в порядке, но обратные слеши неправильно расставлены. Не забудьте исправить их до продолжения редактирования.

```
OBJS = \
        backupfile.o    \
        getopt.o        \
        getopt1.o       \
        inp.o           \
        patch.o         \
        pch.o           \
        util.o          \
        version.o
```

## Сортировка участка текста (Визуальный Метод)

Часто вы будете редактировать файл, содержащий список имен. К примеру, список объектных файлов для компоновки в программу.

Пример:

```
version.o
pch.o
getopt.o
util.o
getopt1.o
inp.o
patch.o
backupfile.o
```

Этот список мило бы выглядел в алфавитном порядке. Или по меньшей мере в последовательности ASCII. Для сортировки по алфавиту введите следующие команды:

| # | Команды |                                              Разъяснение                                              |
|---|---------|-------------------------------------------------------------------------------------------------------|
| 1 |         | Переместите курсор на первую сортируемую строку.                                                      |
| 2 | V       | Войти в строчный визуальный режим                                                                     |
| 3 |         | Перейти вниз сортируемого текста.                                                                     |
| 4 | !sort   | Команда ! указывает Vim обработать подчеркнутый текст командой UNIX. Обрабатывает текст команда sort. |

### Предупреждение

Смотрите секцию предупреждение о сортировке для короткого ознакомления с проблемами при использовании этой команды.

## Работа с Make-файлом и другими SOB файлами

Одной их проблем с файловым форматом, используемым UNIX командой make является его крайняя сумасбродность.

К примеру, это корректно :

```
prog: prog.c
    cc -g -o prog prog.c
```

А это - нет

```
prog: prog.c
    cc -g -o prog prog.c
```

С первого взгляда может показаться, что оба примера одинаковы. Но присмотритесь получше. Строка "cc" в первом случае начинается с таба. Вторая - с восьми пробелов. (На экране не видно отличия межде пробелами и табом! Вам необходима более качественная видеокарта.)

Так как их отличить, если и на экране (или печатной странице) они выглядят одинаково.

Никак. Вы думаете это немного несправедливо. Особенно когда make работает с одни, но не работает с другим. Но кто угодно может сказать что UNIX справедлив.

К счастью в Vim есть режим показывающий что именно находится в вашем файле. Команда

```
:set list
```

переведет вас в этот режим. Когда экран установлен в "list mode", отображаются все символы. Табуляции выглядят как "^I"и конец строки обозначен как $. Таким образом, два наши примера выглядят как:

```
prog: prog.c$
^Icc -g -o prog prog.c$
```

и

```
prog: prog.c$
    cc -g -o prog prog.c$
```

Теперь можно легко разобрать которая строка содержит таб.

## Форматирование параграфа

Редактор Vim не является текстовым процессором. Парень, это не текстовый процессор. Есть куча вещей, которые можно лучше получаются при редактировании текста.

Когда строка выходит за область печати, текстовый процессор автоматически переходит на новую строку. Редактор Vim позволяет делать строки настолько длинными, насколько вы того хотите. Командой:

```
:set wrapmargin=70
```

вы указываете Vim автоматически переходить на новую строку при длине текущей в 70 символов. (Вы можете задать какое угодно число длины строки.)

Это позволит вводить текст гораздо проще. Но не решает проблем редактирования. Если вы введете абзац и затем решите удалить половину слова в первой строке, Vim не переформатирует текст.

Вы может форсировать переформатирование командами:

